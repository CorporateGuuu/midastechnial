<div class="page-header">
  <div class="container">
    <h1>All Products</h1>
    <p>Discover our complete range of premium repair parts and tools</p>
  </div>
</div>

<section class="products-section">
  <div class="container">
    <div class="products-controls">
      <div class="search-filter">
        <input type="text" id="product-search" placeholder="Search products..." class="search-input">
        <button id="search-btn" class="btn btn-primary">
          <i class="fas fa-search"></i> Search
        </button>
      </div>

      <div class="sort-filter">
        <label for="sort-select">Sort by:</label>
        <select id="sort-select" class="sort-select">
          <option value="newest">Newest First</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
          <option value="name">Name A-Z</option>
        </select>
      </div>
    </div>

    <div class="products-grid" id="products-grid">
      <% if (typeof products !== 'undefined' && products.length > 0) { %>
        <% products.forEach(product => { %>
          <div class="product-card" data-product-id="<%= product.id %>">
            <div class="product-image">
              <% if (product.image_url) { %>
                <img src="<%= product.image_url %>" alt="<%= product.name %>" loading="lazy">
              <% } else { %>
                <div class="no-image">
                  <i class="fas fa-image"></i>
                </div>
              <% } %>
              <% if (product.is_featured) { %>
                <span class="featured-badge">Featured</span>
              <% } %>
              <% if (product.is_new) { %>
                <span class="new-badge">New</span>
              <% } %>
            </div>
            <div class="product-info">
              <h3 class="product-name">
                <a href="/products/<%= product.slug || product.id %>"><%= product.name %></a>
              </h3>
              <div class="product-price">
                <% if (product.discount_percentage > 0) { %>
                  <span class="original-price">$<%= product.price %></span>
                  <span class="current-price">$<%= (product.price * (1 - product.discount_percentage / 100)).toFixed(2) %></span>
                  <span class="discount-badge"><%= product.discount_percentage %>% OFF</span>
                <% } else { %>
                  <span class="current-price">$<%= product.price %></span>
                <% } %>
              </div>
              <div class="product-meta">
                <% if (product.category_name) { %>
                  <span class="category"><%= product.category_name %></span>
                <% } %>
                <% if (product.brand) { %>
                  <span class="brand">by <%= product.brand %></span>
                <% } %>
              </div>
              <div class="product-stock">
                <% if (product.stock_quantity > 0) { %>
                  <span class="in-stock">In Stock (<%= product.stock_quantity %> available)</span>
                <% } else { %>
                  <span class="out-of-stock">Out of Stock</span>
                <% } %>
              </div>
              <div class="product-actions">
                <a href="/products/<%= product.slug || product.id %>" class="btn btn-primary">View Details</a>
                <% if (product.stock_quantity > 0) { %>
                  <button class="btn btn-secondary add-to-cart-btn" data-product-id="<%= product.id %>">
                    <i class="fas fa-cart-plus"></i> Add to Cart
                  </button>
                <% } %>
              </div>
            </div>
          </div>
        <% }); %>
      <% } else { %>
        <div class="no-products">
          <i class="fas fa-box-open"></i>
          <h3>No products found</h3>
          <p>Try adjusting your search or filters.</p>
        </div>
      <% } %>
    </div>

    <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
      <div class="pagination">
        <% if (currentPage > 1) { %>
          <a href="?page=<%= currentPage - 1 %>" class="pagination-link">&laquo; Previous</a>
        <% } %>

        <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
          <% if (i === currentPage) { %>
            <span class="pagination-link active"><%= i %></span>
          <% } else { %>
            <a href="?page=<%= i %>" class="pagination-link"><%= i %></a>
          <% } %>
        <% } %>

        <% if (currentPage < totalPages) { %>
          <a href="?page=<%= currentPage + 1 %>" class="pagination-link">Next &raquo;</a>
        <% } %>
      </div>
    <% } %>
  </div>
</section>
